---
- name: Ensure custom configuration block is absent from bashrc
  blockinfile:
    path: "{{ bashrc_target_file }}"
    marker: "# {mark} {{ bashrc_marker_name }}"
    state: absent
    backup: yes

- name: Ensure custom prompt script is removed
  file:
    path: "{{ bashprompt_target_file }}"
    state: absent

- name: Ensure alias configuration is removed from bashrc.d
  file:
    path: /etc/bashrc.d/alias
    state: absent

- name: Check for remaining files in bashrc.d directory
  find:
    paths: /etc/bashrc.d
    hidden: yes
    recurse: no
  register: dir_content
  ignore_errors: yes

- name: Remove bashrc.d directory if empty
  file:
    path: /etc/bashrc.d
    state: absent
  when:
    - dir_content.matched is defined
    - dir_content.matched == 0